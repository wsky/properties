@{
    ViewBag.Title = "Table";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var label = new string[] { "label-success", "label-warning", "label-important", "label-info", "label-inverse" };
    var app = ViewBag.App as Properties.Model.Application;
    var c = ViewBag.Configuration as Properties.Model.Configuration;
}

@section Head{
    <style type="text/css">
        div.row div.span3
        {
            padding: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height:25px;
            max-height:50px;
            word-break:break-all;
        }
        div.row div.span2{ cursor:pointer;}
        div.row div.span2 a{ text-decoration:none; color:#232323}
        .pop-title{ color:#d14;}
        .pop-content{ line-height:25px; word-break:break-all}
        div.modal form textarea{ height:100px; width:95%}
        div.modal form input{ width:95%}
    </style>
}
<header>
    <h1>
        @c.Name</h1>
    <p class="lead">@c.Description
    @for (var i = 0; i < c.Flags.Count(); i++)
    { 
        <span class="label @label[i % 5]">@c.Flags.ElementAt(i)</span>    
    }
    <div class="btn-toolbar">
        <div class="btn-group">
            <a class="btn" href="#edit_config" data-toggle="modal">
                <i class="icon-cog"></i>
                Edit
            </a>
        </div>
        <div class="btn-group">
            <button class="btn btn-success">
                <i class="icon-upload"></i>
                Commit All
            </button>
        </div>
        <div class="btn-group">
            <a class="btn btn-danger" href="#edit_drop" data-toggle="modal">
                <i class="icon-trash"></i>
                Drop Configuration
            </a>
        </div>
    </div>
    </p>

    <div class="alert">PS: you must committed changes after updating properties. </div>
</header>
<div class="tabbable">
  <ul class="nav nav-tabs">
    <li class="active"><a href="#tab1" data-toggle="tab">Properties</a></li>
    <li><a href="#tab2" data-toggle="tab">uncommited</a></li>
    <li><a href="#tab3" data-toggle="tab">logs</a></li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab1">
        @using (Html.BeginForm())
        {
            <div class="input-append control-group">
                @Html.Hidden("id", c.ID)
                <input type="text" name="name" placeholder="property name" /><button type="submit" class="btn" onclick="return check()"><i class="icon-plus"></i>&nbsp;New Property</button>
            </div>
        }
        <div class="row">
            @for (var j = 0; j < c.Properties.Count(); j++)
            {
                var p = c.GetProperty(c.Properties.ElementAt(j));
                <div class="span2 well"
                    id="@p.Name"
                    data-original-title="<span class='pop-title'>@p.Name</span>" 
                    data-content="
                    <div class='pop-content'>
                        @for (var i = 0; i < c.Flags.Count(); i++)
                        {
                            <span class='label @label[i % 5]'>@c.Flags.ElementAt(i)</span>
                            <div>@p[c.Flags.ElementAt(i)]</div>
                        }
                    </div>
                    "> <a href="#@p.Name"><code>@p.Name</code>
                        @p.Description
                        <p>
                            @p.Value
                        </p>
                    </a>
                </div>
            }
        </div>
    </div>
    <div class="tab-pane" id="tab2">
        <ul class="nav nav-tabs nav-stacked">
            <li>
                <a>
                    <span class="badge">2012-10-10</span>
                    wsky change
                    <code>key</code> from <span class="label label-important">1</span> to <span class="label label-success">1</span>
                     <button class="close">x</button>
                </a>
            </li>
        </ul>
    </div>
    <div class="tab-pane" id="tab3">
        <ul class="nav nav-tabs nav-stacked">
            <li>
                <a>
                    <button class="btn"><i class="icon-repeat"></i></button>
                    <span class="badge">2012-10-10</span>
                    wsky change
                    <code>key:Debug</code> from <span class="label label-important">1</span> to <span class="label label-success">1</span>
                </a>
            </li>
            <li>
                <a>
                    <button class="btn"><i class="icon-repeat"></i></button>
                    <span class="badge">2012-10-10</span>
                    wsky change
                    <code>key</code> from <span class="label label-important">1</span> to <span class="label label-success">1</span>
                </a>
            </li>
        </ul>
    </div>
  </div>
</div>

<div class="modal hide" id="edit_config">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
            ×</button>
        <h3>
            Edit Configuration</h3>
    </div>
    <div class="modal-body">
        @using (Html.BeginForm())
        {
            <textarea name="description" placeholder="Configuration Description"></textarea>
            <br />
            <span class="label">Flags</span>
            <br />
            <input type="text" maxlength="100" placeholder="Multiple options separated by commas ','" />
        }
    </div>
    <div class="modal-footer">
        <a class="btn" data-dismiss="modal">Cancel</a> 
        <button type="submit" name="btn" class="btn btn-primary">Done</button>
    </div>
</div>
<div class="modal hide" id="edit_property">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
            ×</button>
        <h3>
            Edit Property</h3>
    </div>
    <div class="modal-body">
        @using (Html.BeginForm())
        {
            <label>Value:</label>
            <textarea name="value" placeholder="Property value"></textarea>
            <br />
            <label>Description:</label>
            <textarea name="description" placeholder="Property description"></textarea>
            <br />
            for (var i = 0; i < c.Flags.Count(); i++)
            { 
                <span class="label @label[i % 5]">@c.Flags.ElementAt(i)</span>
                <br />
                <textarea name="@c.Flags.ElementAt(i)" placeholder="Property value at @c.Flags.ElementAt(i) flag"></textarea>   
                <br />
            }
        }
    </div>
    <div class="modal-footer">
        <a class="btn" data-dismiss="modal">Cancel</a> 
        <button type="submit" name="btn" class="btn btn-primary">Done</button>
    </div>
</div>
<div class="modal hide" id="edit_drop">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
            ×</button>
        <h3>
            Drop Configuration ?</h3>
    </div>
    <div class="modal-body">
        @using (Html.BeginForm())
        {
            <p class="alert alert-error">
                <strong>Confirm?</strong>
            </p>
        }
    </div>
    <div class="modal-footer">
        <a class="btn" data-dismiss="modal">Cancel</a> 
        <button type="submit" name="btn" class="btn btn-danger">Drop it</button>
    </div>
</div>
@section Bottom{
    <script type="text/javascript">
        $(function () {
            $('div.span2').popover().click(function () { $('#edit_property').modal('show'); });
        });
        function check() {
            var b = $.trim($('input[name="name"]').val()) != '';
            $('.control-group')[b ? 'removeClass' : 'addClass']('error');
            return b;
        }
    </script>
}